---
kind: pipeline
type: docker
name: docker-build-push

platform:
  os: linux
  arch: amd64

steps:

- name: Scan with WIZCLI
  image: wiziocli.azurecr.io/wizcli:latest
  environment:
    WIZ_POLICY: david-iac
    WIZ_CLIENT_ID:
      from_secret: WIZ_CLIENT_ID
    WIZ_CLIENT_SECRET:
      from_secret: WIZ_CLIENT_SECRET
    WIZ_ENV:
      from_secret: WIZ_ENV
  commands:
    - echo $WIZ_CLIENT_ID
    - /entrypoint auth --id wgxq75hrlndpbktx3eupevf2x363p5wacqsv4z5xbqndwtq6vi4xg --secret 3AjTFPxVrNonJPXDi1rmTPSZD8zXmDNVoMSFo0V5gta4eUx0T3CA5op2YeGwHWuy
    - /entrypoint iac scan --path ./ -p $WIZ_POLICY
