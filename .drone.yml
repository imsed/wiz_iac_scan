---
kind: pipeline
type: docker
name: docker-build-push

platform:
  os: linux
  arch: amd64

steps:

- name: Scan with WIZCLI
  image: wiziocli.azurecr.io/wizcli:latest
  environment:
    WIZ_POLICY: david-iac
    WIZ_CLIENT_ID:
      from_secret: WIZ_CLIENT_ID
    WIZ_CLIENT_SECRET:
      from_secret: WIZ_CLIENT_SECRET
  commands:
    - echo $WIZ_CLIENT_ID
    - /entrypoint auth --id wgxq75hrlndpbktx3eupevf2xzcy3dcftn3fib4qhdliczkzlifhg --secret tknefExtyhULBvm1M7quC0eUJGw7BKaTBc4z5ZInJPanSR5xPofMXN0j5PVhEJZ8
    - /entrypoint iac scan --path ./ -p $WIZ_POLICY
